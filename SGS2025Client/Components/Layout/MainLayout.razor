@inherits LayoutComponentBase


<div class="bb-page">

    <Sidebar @ref="sidebar"
    Href="/"
    IconName="IconName.Power"
    Title="SmartScale_BK"
    DataProvider="SidebarDataProvider"/>
 
    <main>
    
        <div class="bb-top-row px-4 d-flex justify-content-between align-items-center" style="background-color: #4e01e5">
            <!-- Toggle Sidebar -->
            <Icon Name="IconName.List" Color="IconColor.Danger" role="button" @onclick="ToggleSidebar" />

            <!-- Logout -->
            <button class="btn btn-sm btn-danger" @onclick="OnLogoutClicked">
                <Icon Name="IconName.BoxArrowRight" /> Đăng xuất
            </button>
        </div>
        <article class="content px-4">
            <div class="py-2">@Body</div>
        </article>
    </main>

</div>

@code {
    Sidebar sidebar = default!;
    IEnumerable<NavItem>? navItems;

    private async Task<SidebarDataProviderResult> SidebarDataProvider(SidebarDataProviderRequest request)
    {
        if (navItems is null)
            navItems = GetNavItems();
        return await Task.FromResult(request.ApplyTo(navItems));
    }
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
              sidebar.ToggleSidebar();
        }
    }

    private IEnumerable<NavItem> GetNavItems()
    {
        navItems = new List<NavItem>
        {
            new NavItem { Id = "1", Href = "/", IconName = IconName.HouseDoorFill, Text = "Trang chủ"},

            new NavItem { Id = "2", Href = "/scalewithimage", IconName = IconName.Speedometer2, Text = "Cân hàng", IconColor = IconColor.Primary },
            new NavItem { Id = "3", Href = "/hik", IconName = IconName.PersonSquare, Text = "Hikvision", IconColor = IconColor.Primary },
            new NavItem { Id = "4", Href = "/dahua", IconName = IconName.InputCursorText, Text = "Dahua", IconColor = IconColor.Primary },
            new NavItem { Id = "5", Href = "/tvt", IconName = IconName.InputCursorText, Text = "tvt", IconColor = IconColor.Primary },
             new NavItem { Id = "6", Href = "/camera", IconName = IconName.CurrencyDollar, Text = "Camera", IconColor = IconColor.Primary },
             new NavItem { Id = "7", Href = "/test", IconName = IconName.Airplane, Text = "Test", IconColor = IconColor.Primary },
              new NavItem { Id = "10", Href = "/config", IconName = IconName.Controller, Text = "Cấu hình", IconColor = IconColor.Primary },
               new NavItem { Id = "11", Href = "/system", IconName = IconName.Cassette, Text = "Hệ thống", IconColor = IconColor.Primary },
            // new NavItem { Id = "4", IconName = IconName.ExclamationTriangleFill, Text = "Components", IconColor = IconColor.Success },
            // new NavItem { Id = "5", Href = "/alerts", IconName = IconName.CheckCircleFill, Text = "Alerts", ParentId="4"},
            // new NavItem { Id = "6", Href = "/breadcrumb", IconName = IconName.SegmentedNav, Text = "Breadcrumb", ParentId="4"},
            // new NavItem { Id = "7", Href = "/sidebar", IconName = IconName.LayoutSidebarInset, Text = "Sidebar", ParentId="4"},

             new NavItem { Id = "20", IconName = IconName.WindowPlus, Text = "Danh mục", IconColor = IconColor.Danger },
             new NavItem { Id = "21", Href = "/vehicles", IconName = IconName.BadgeVoFill, Text = "Xe", ParentId="20"},
             new NavItem { Id = "22", Href = "/products", IconName = IconName.Projector, Text = "Sản phẩm", ParentId="20"},
              new NavItem { Id = "23", Href = "/customers", IconName = IconName.Person, Text = "Khách hàng", ParentId="20"},
            // new NavItem { Id = "12", Href = "/switch", IconName = IconName.ToggleOn, Text = "Switch", ParentId="8"},
        };

        return navItems;
    }
    private async Task OnLogoutClicked()
    {
        // Xóa thông tin đăng nhập đã lưu
        SecureStorage.Remove("username");
        SecureStorage.Remove("password_hash");

        // Quay lại trang Login
        if (Application.Current is App app)
        {
            var authService = IPlatformApplication.Current.Services.GetRequiredService<AuthService>();
            app.MainPage = new NavigationPage(new LoginPage(authService));
        }
    }
    private void ToggleSidebar() => sidebar.ToggleSidebar();
}